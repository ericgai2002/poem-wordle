<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>è¯—è¯ Wordle</title>
<style>
  body{font-family:"Helvetica Neue",Arial,sans-serif;text-align:center;padding:2rem;background:#f5f5f5}
  h1{margin-bottom:0.3rem}
  #lengthInfo{margin:0 0 1rem 0;font-size:18px;color:#555}
  #board{display:flex;flex-direction:column;gap:6px;align-items:center;margin-bottom:1rem}
  .row{display:flex;gap:6px}
  .tile{width:38px;height:38px;border:2px solid #d3d6da;display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:bold;background:#fff;border-radius:4px;user-select:none}
  .correct{background:#6aaa64;border-color:#6aaa64;color:#fff}
  .present{background:#c9b458;border-color:#c9b458;color:#fff}
  .absent{background:#787c7e;border-color:#787c7e;color:#fff}
  #guess{font-size:20px;padding:6px;width:300px;border-radius:4px;border:1px solid #ccc;margin-bottom:0.5rem}
  #submit{font-size:18px;padding:6px 14px;border:none;border-radius:4px;background:#538d4e;color:#fff;cursor:pointer}
  #submit:disabled{background:#9aa0a6;cursor:not-allowed}
  #message{height:1.4rem;margin-top:0.5rem;color:#d32f2f}
</style>
<script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js">
  (async () => {
  // éšæœºå†³å®š 10 è¿˜æ˜¯ 14 å­—
  const needLen = Math.random() < 0.5 ? 10 : 14;

  try{
    const poem = await fetchPoem(needLen);   // åŠ¨æ€æ‹¿è¯—å¥
    startGame(poem);                         // å¯åŠ¨æ¸¸æˆ
  }catch(e){
    console.error('åŠ è½½è¯—å¥å¤±è´¥ï¼Œè½¬ç”¨æœ¬åœ°æ•°ç»„', e);

    // ---- å›é€€åˆ°æœ¬åœ°é¢˜åº“ ----
    const fallback = POEMS.filter(p=>p.length===needLen);
    const poem = fallback[Math.floor(Math.random()*fallback.length)];
    startGame(poem);
  }
})();

</script>
</head>
<body>
  <h1>çŒœè¯—å¥ Wordle</h1>
  <p id="lengthInfo"></p>
  <div id="board"></div>
  <input id="guess" placeholder="è¾“å…¥å®Œæ•´è¯—å¥" maxlength="14" autofocus>
  <div>
    <button id="submit">æäº¤</button>
  </div>
  <p id="message"></p>

<script>
  // -------- åŠ¨æ€è·å– 10/14 å­—è¯—å¥ ----------
function fetchPoem(lenNeeded) {
  return new Promise((resolve, reject) => {
    jinrishici.load(res => {
      // å»æ‰å…¨éƒ¨ä¸­æ–‡/è‹±æ–‡æ ‡ç‚¹ä¸ç©ºç™½
      const sentence = res.data.content.replace(/[ï¼Œã€‚ï¼ï¼Ÿï¼›,.!?;\\s]/g, '');
      if (sentence.length === lenNeeded) {
        resolve(sentence);
      } else {
        // ä¸åˆé•¿åº¦ â†’ é€’å½’å†æ‹‰ä¸€æ¬¡
        fetchPoem(lenNeeded).then(resolve).catch(reject);
      }
    }, err => reject(err));
  });
}
// --- é¢˜åº“ï¼š5Ã—2 å’Œ 7Ã—2 è¯—å¥ ---
const poems10 = [
  "ç™½æ—¥ä¾å±±å°½é»„æ²³å…¥æµ·æµ",
  "æ˜¥çœ ä¸è§‰æ™“å¤„å¤„é—»å•¼é¸Ÿ",
  "ä¼šå½“å‡Œç»é¡¶ä¸€è§ˆä¼—å±±å°",
  "ç©ºå±±ä¸è§äººä½†é—»äººè¯­å“",
  "æ±Ÿå—å¯é‡‡è²è²å¶ä½•ç”°ç”°",
  "æœˆé»‘é›é£é«˜å•äºå¤œéé€ƒ"
];

const poems14 = [
  "é»„æ²³è¿œä¸Šç™½äº‘é—´ä¸€ç‰‡å­¤åŸä¸‡ä»å±±",
  "è‘¡è„ç¾é…’å¤œå…‰æ¯æ¬²é¥®çµç¶é©¬ä¸Šå‚¬",
  "å¤©ç”Ÿæˆ‘æå¿…æœ‰ç”¨åƒé‡‘æ•£å°½è¿˜å¤æ¥"
];

const POEMS = poems10.concat(poems14);
// const answer = POEMS[Math.floor(Math.random() * POEMS.length)];
// const answerLen = answer.length; // 10 or 14

// åœ¨é¡µé¢é¡¶éƒ¨æ˜¾ç¤ºæœ¬å±€å­—æ•°
// const lenInfoEl = document.getElementById('lengthInfo');
// lenInfoEl.textContent = `æœ¬å±€è¯—å¥å…± ${answerLen} å­—`;

function startGame(answer){
  const answerLen = answer.length;
  lenInfoEl.textContent = `æœ¬å±€è¯—å¥å…± ${answerLen} å­—`;
  // å…¶ä½™åŸæœ¬å¯¹ answerLen / answer çš„å®šä¹‰ã€äº‹ä»¶ç»‘å®šã€å‡½æ•°ç­‰
  // éƒ½ä¿æŒä¸å˜ï¼Œåªè¦æ”¾åˆ°è¿™ä¸ªå‡½æ•°å—é‡Œ
}

const board = document.getElementById('board');
const input = document.getElementById('guess');
const submitBtn = document.getElementById('submit');
const msg = document.getElementById('message');

let attempts = 0;
const MAX_ATTEMPTS = 20;

submitBtn.addEventListener('click', handleGuess);
input.addEventListener('keypress', e => { if (e.key === 'Enter') handleGuess();});

function handleGuess(){
  const guessRaw = input.value.trim();
  if(guessRaw.length !== answerLen){
    showMessage(`éœ€è¾“å…¥ ${answerLen} ä¸ªå­—ï¼Œä½ è¾“å…¥äº† ${guessRaw.length} ä¸ªã€‚`);
    return;
  }
  if([...guessRaw].some(ch => /\s/.test(ch))){
    showMessage('è¯·å‹¿åŒ…å«ç©ºæ ¼æˆ–æ ‡ç‚¹');
    return;
  }
  attempts++;
  renderRow(guessRaw);
  if(guessRaw === answer){
    showMessage(`ğŸ‰ æ­å–œï¼ä½ åœ¨ç¬¬ ${attempts} æ¬¡çŒœä¸­ï¼`, true);
    endGame();
    return;
  }
  if(attempts >= MAX_ATTEMPTS){
    showMessage(`ğŸ’¡ æœºä¼šç”¨å°½ï¼ç­”æ¡ˆæ˜¯ï¼š${answer}`, true);
    endGame();
  } else {
    showMessage('');
  }
  input.value = '';
  input.focus();
}

function renderRow(guess){
  const row = document.createElement('div');
  row.className = 'row';

  const guessChars = [...guess];
  const answerChars = [...answer];
  const statusArr = Array(answerLen).fill('absent');

  // æ ‡è®°æ­£ç¡®ä½ç½®
  guessChars.forEach((ch,i)=>{
    if(ch === answerChars[i]){
      statusArr[i] = 'correct';
      answerChars[i] = null;
    }
  });
  // æ ‡è®°å­˜åœ¨ä½†ä½ç½®ä¸å¯¹
  guessChars.forEach((ch,i)=>{
    if(statusArr[i] !== 'correct' && answerChars.includes(ch)){
      statusArr[i] = 'present';
      answerChars[answerChars.indexOf(ch)] = null;
    }
  });

  // æ¸²æŸ“
  guessChars.forEach((ch,i)=>{
    const cell = document.createElement('span');
    cell.className = 'tile ' + statusArr[i];
    cell.textContent = ch;
    row.appendChild(cell);
  });
  board.appendChild(row);
  board.scrollTop = board.scrollHeight;
}

function showMessage(text, persistent=false){
  msg.textContent = text;
  if(!persistent && text){
    setTimeout(()=>{msg.textContent='';}, 2000);
  }
}

function endGame(){
  submitBtn.disabled = true;
  input.disabled = true;
}
</script>
</body>
</html>
