<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>诗词 Wordle</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body{font-family:"Helvetica Neue",Arial,sans-serif;text-align:center;padding:2rem;background:#f5f5f5}
  h1{margin-bottom:0.3rem}
  #lengthInfo{margin:0 0 1rem 0;font-size:18px;color:#555}
  #board{display:flex;flex-direction:column;gap:6px;align-items:center;margin-bottom:1rem}
  .row{display:flex;gap:6px}
  .tile{width:38px;height:38px;border:2px solid #d3d6da;display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:bold;background:#fff;border-radius:4px;user-select:none}
  .correct{background:#6aaa64;border-color:#6aaa64;color:#fff}
  .present{background:#c9b458;border-color:#c9b458;color:#fff}
  .absent{background:#787c7e;border-color:#787c7e;color:#fff}
  #guess{font-size:20px;padding:6px;width:320px;border-radius:4px;border:1px solid #ccc;margin-bottom:0.5rem}
  #submit{font-size:18px;padding:6px 14px;border:none;border-radius:4px;background:#538d4e;color:#fff;cursor:pointer}
  #submit:disabled{background:#9aa0a6;cursor:not-allowed}
  #message{height:1.4rem;margin-top:0.5rem;color:#d32f2f}
</style>
<script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js"></script>
</head>
<body>
  <h1>猜诗句 Wordle</h1>
  <p id="lengthInfo">正在加载诗句…</p>
  <div id="board"></div>
  <input id="guess" placeholder="输入完整诗句" maxlength="14" autofocus>
  <div>
    <button id="submit" disabled>提交</button>
  </div>
  <p id="message"></p>

<script>
/********** 本地备用题库 **********/
const poems10=["白日依山尽黄河入海流","春眠不觉晓处处闻啼鸟","会当凌绝顶一览众山小","空山不见人但闻人语响","江南可采莲莲叶何田田","欲穷千里目更上一层楼","国破山河在城春草木深","春风又绿江南岸明月何时照我还","孤帆远影碧空尽唯见长江天际流","窗含西岭千秋雪门泊东吴万里船","黄四娘家花满蹊千朵万朵压枝低","千山鸟飞绝万径人踪灭","月落乌啼霜满天江枫渔火对愁眠","野火烧不尽春风吹又生","柴门闻犬吠风雪夜归人","银烛秋光冷画屏轻罗小扇扑流萤","前不见古人后不见来者","大漠孤烟直长河落日圆","山重水复疑无路柳暗花明又一村","锄禾日当午汗滴禾下土","举头望明月低头思故乡","欲把西湖比西子淡妆浓抹总相宜","青青子衿悠悠我心","明月松间照清泉石上流"];
const poems14=["黄河远上白云间一片孤城万仞山","葡萄美酒夜光杯欲饮琵琶马上催","月黑雁飞高单于夜遁逃","天生我材必有用千金散尽还复来","海内存知己天涯若比邻","劝君更尽一杯酒西出阳关无故人","人生得意须尽欢莫使金樽空对月","桃花潭水深千尺不及汪伦送我情","醉卧沙场君莫笑古来征战几人回","塞下秋来风景异衡阳雁去无留意","黄沙百战穿金甲不破楼兰终不还","黑云压城城欲摧甲光向日金鳞开","竹外桃花三两枝春江水暖鸭先知","接天莲叶无穷碧映日荷花别样红","白日放歌须纵酒青春作伴好还乡","山回路转不见君雪上空留马行处","烽火连三月家书抵万金"];

/********** 在线获取诗句，带超时与重试 **********/
async function fetchPoem(lenNeeded,maxTry=8){
  for(let i=0;i<maxTry;i++){
    try{
      const sentence=await new Promise((res,rej)=>{
        const timer=setTimeout(()=>rej(new Error('timeout')),2000);
        jinrishici.load(r=>{clearTimeout(timer);res(r.data.content.replace(/[，。！？；,.!?;\s]/g,''));},err=>{clearTimeout(timer);rej(err);});
      });
      if(sentence.length===lenNeeded) return sentence;
    }catch(e){ /* ignore and retry */ }
  }
  throw new Error('max try exceeded');
}

/********** Wordle 逻辑 **********/
const board=document.getElementById('board');
const input=document.getElementById('guess');
const submitBtn=document.getElementById('submit');
const msg=document.getElementById('message');
const lenInfoEl=document.getElementById('lengthInfo');
let answer='',answerLen=0,attempts=0;const MAX_ATTEMPTS=6;
function startGame(poem){
  answer=poem;answerLen=poem.length;
  lenInfoEl.textContent=`本局诗句共 ${answerLen} 字`;
  input.maxLength=answerLen;submitBtn.disabled=false;
  submitBtn.addEventListener('click',handleGuess);
  input.addEventListener('keypress',e=>{if(e.key==='Enter')handleGuess();});
}
function handleGuess(){
  const guessRaw=input.value.trim();
  if(guessRaw.length!==answerLen){showMessage(`需输入 ${answerLen} 个字，你输入了 ${guessRaw.length} 个。`);return;}
  if(/[\s]/.test(guessRaw)){showMessage('请勿包含空格或标点');return;}
  attempts++;renderRow(guessRaw);
  if(guessRaw===answer){showMessage(`🎉 恭喜！你在第 ${attempts} 次猜中！`,true);endGame();return;}
  if(attempts>=MAX_ATTEMPTS){showMessage(`💡 机会用尽！答案是：${answer}`,true);endGame();}else{showMessage('');}
  input.value='';input.focus();
}
function renderRow(guess){
  const row=document.createElement('div');row.className='row';
  const guessChars=[...guess];const answerChars=[...answer];const statusArr=Array(answerLen).fill('absent');
  guessChars.forEach((ch,i)=>{if(ch===answerChars[i]){statusArr[i]='correct';answerChars[i]=null;}});
  guessChars.forEach((ch,i)=>{if(statusArr[i]!=='correct'&&answerChars.includes(ch)){statusArr[i]='present';answerChars[answerChars.indexOf(ch)]=null;}});
  guessChars.forEach((ch,i)=>{const cell=document.createElement('span');cell.className='tile '+statusArr[i];cell.textContent=ch;row.appendChild(cell);});
  board.appendChild(row);board.scrollTop=board.scrollHeight;
}
function showMessage(text,persistent=false){msg.textContent=text;if(!persistent&&text){setTimeout(()=>{msg.textContent='';},2000);}}
function endGame(){submitBtn.disabled=true;input.disabled=true;}

/********** 初始化 **********/
(async()=>{
  const needLen=Math.random()<0.5?10:14;
  try{
    const poem=await fetchPoem(needLen);
    startGame(poem);
  }catch(e){
    console.warn('在线获取失败，使用本地题库',e);
    const fallback=(needLen===10?poems10:poems14);
    const poem=fallback[Math.floor(Math.random()*fallback.length)];
    startGame(poem);
  }
})();
</script>
</body>
</html>